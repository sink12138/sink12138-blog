# 网络协议


## (应用层) HTTP 

### 状态码

- 1xx 信息

- 2xx 请求成功

- 3xx 重定向

- 4xx 客户端错误

- 5xx 服务端错误

| 101 | Switching Protocols | 切换协议 |
| --- | --- | --- |
| 200 | OK | 成功 |
| 204 | No Content | 预见请求：成功且不需要离开页面 |
| 206 | Partial Content | 范围请求：Range，If Range |
| 301 | Moved Permanently | 永久重定向 |
| 302 | Found | 临时重定向 |
| 304 | Not Modified | 存在协商缓存 |
| 400 | Bad Request | 客户端错误 |
| 401 | Unauthorized | 认证失败 |
| 403 | Forbidden | 拒绝访问 |
| 404 | Not Found | 文件不存在 |
| 405 | Method Not Allowed | 请求方式错误 |
| 415 | Unsupported Media Type | 未知媒体类型 |
| 500 | Internal Server Error | 服务器异常 |
| 502 | Bad Gateway | 网关错误 |
| 503 | Service Unavailable | 服务器停机/繁忙 |
| 504 | GateWay Timeout | 网关服务器超时 |

### 数据格式

| application/x-www-form-urlencoded |  key-value |
| --- | --- |
| application/json | JSON |
| mutipart/form-data | 多部分多媒体 |
| text/xml | XML |

### 请求方式

| GET | 安全 幂等 可缓存 ASCII | 信息获取/请求指定资源 |
| --- | --- | --- |
| POST | 数据包含在请求体，可能新建资源/修改 | 提交数据/处理请求 |
| OPTIONS | CORS预检 | 获取资源支持的通信 |
| PUT | 通常指定资源存放位置 | 创建/替换目标资源 |
| HEAD | 下载资源前先获取大小 | 请求头部信息 |
| DELETE | 没有 请求正文/返回主体 | 删除指定资源 |
| PATCH | 指定位置 非幂等 | 资源进行部分修改 |

### 队头阻塞

在 HTTP/1.1 中，如果客户端向服务器发送多个请求而不等待响应，服务器会按顺序处理这些请求。如果第一个请求的响应被延迟，后续请求的响应也会被延迟。HTTP/2 通过请求多路复用解决了应用层的队头阻塞，但在传输层 TCP 仍然存在。

### HTTP2

基于https，加密可选

- 多路复用
- 二进制传输
- 头部压缩
- SSE

### HTTP3

基于udp封装一层quic协议，彻底解决tcp阻塞

### HTTPS

#### 基本原理

HTTPS（HTTP Secure）是在HTTP基础上通过SSL/TLS协议提供加密、身份验证和数据完整性保护的协议。

#### 加密过程

1. **握手阶段**
   ```
   客户端 → 服务器：ClientHello（支持的加密套件、随机数）
   服务器 → 客户端：ServerHello（选择的加密套件、随机数、证书）
   客户端 → 服务器：验证证书，生成预主密钥，用服务器公钥加密发送
   双方：根据随机数和预主密钥生成会话密钥
   ```

2. **数据传输阶段**
   ```
   明文数据 → 会话密钥加密 → 密文传输 → 会话密钥解密 → 明文数据
   ```

#### 核心组件

- **对称加密**：使用会话密钥加密实际数据（AES、ChaCha20等）
- **非对称加密**：用于密钥交换（RSA、ECDHE等）
- **数字证书**：验证服务器身份
- **消息认证码（MAC）**：确保数据完整性

#### 为什么HTTPS仍然可能被抓包

1. 中间人攻击（MITM）

```
客户端 ←→ 攻击者 ←→ 服务器
```

**实现方式**：
- **代理服务器**：如Charles、Fiddler等抓包工具
- **恶意WiFi**：公共WiFi可能被恶意配置
- **DNS劫持**：将域名解析到攻击者服务器
- **证书伪造**：使用自签名证书或已泄露的私钥

2. 证书验证绕过

**抓包工具原理**：
1. 在系统中安装根证书
2. 拦截HTTPS请求
3. 用自签名证书替换服务器证书
4. 客户端信任根证书，接受伪造证书


## (传输层) TCP UDP 

`TCP`: 面向连接、可靠、有序、带流量控制

`UDP`: 无连接、轻量、不保证到达不保证顺序、延迟低

| 特性             | TCP                                | UDP                               |
|------------------|-------------------------------------|-----------------------------------|
| 连接性            | 面向连接（三次握手）                  | 无连接（直接发包）                  |
| 传输模型          | 字节流（stream）                       | 数据报（message）— 保留报文边界         |
| 可靠性            | 可靠（ACK、重传、序号）                 | 不可靠（不重传、不ACK）                |
| 顺序保证           | 保证按序到达                           | 不保证（需应用层处理）                  |
| 流量控制        | 有（窗口、慢启动等）                      | 无（默认）                            |
| 首部长度           | 最小 20 bytes（可扩展 Options）         | 8 bytes                             |
| 校验和             | 必须（IPv4/IPv6 均需）                   | IPv4 可选（0 表示未计算），IPv6 必须      |
| 支持广播/多播        | 否（不支持）                             | 支持                                 |
| 典型用途            | HTTP(S)、FTP、SMTP、SSH                | DNS、DHCP、RTP（实时媒体）、QUIC（基于UDP） |
| NAT/防火墙影响      | 状态连接，易被跟踪                         | 无连接，UDP 穿透（hole punching）常用       |
